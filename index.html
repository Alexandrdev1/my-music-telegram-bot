<script>
    // Мини-игра
    document.addEventListener('DOMContentLoaded', function() {
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startBtn = document.getElementById('startGame');
        const scoreElement = document.getElementById('score');
        const timeElement = document.getElementById('time');
        
        let gameRunning = false;
        let score = 0;
        let gameTime = 0;
        let gameTimer;

        // Загружаем картинки
        const dinoImg = new Image();
        dinoImg.src = "cat.png"; // персонаж

        const obstacleImg = new Image();
        obstacleImg.src = "cactus.png"; // препятствие
        
        let dino = { x: 50, y: 150, width: 30, height: 30, jumping: false, velocity: 0 };
        let obstacles = [];
        let coins = [];
        
        // для контроля интервала между кактусами
        let lastObstacleTime = 0;

        function startGame() {
            gameRunning = true;
            score = 0;
            gameTime = 0;
            obstacles = [];
            coins = [];
            dino.y = 150;
            dino.jumping = false;
            scoreElement.textContent = score;
            timeElement.textContent = gameTime;
            
            clearInterval(gameTimer);
            gameTimer = setInterval(() => {
                if (gameRunning) {
                    gameTime++;
                    timeElement.textContent = gameTime;
                }
            }, 1000);
            
            requestAnimationFrame(gameLoop);
        }
        
        function drawDino() {
            ctx.drawImage(dinoImg, dino.x, dino.y - (64 - dino.height), 64, 64);
        }
        
        function updateDino() {
            if (dino.jumping) {
                dino.y += dino.velocity;
                dino.velocity += 0.5;
                if (dino.y >= 150) {
                    dino.y = 150;
                    dino.jumping = false;
                }
            }
        }
        
        function jump() {
            if (!dino.jumping) {
                dino.jumping = true;
                dino.velocity = -12;
            }
        }
        
        function gameLoop(timestamp) {
            if (!gameRunning) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            updateDino();
            drawDino();
            
            // препятствия (только если прошло достаточно времени с последнего)
            if (timestamp - lastObstacleTime > 1500 && Math.random() < 0.02) {
                obstacles.push({ x: canvas.width, y: 150, width: 20, height: 30 });
                lastObstacleTime = timestamp;
            }

            // монетки
            if (Math.random() < 0.01) {
                coins.push({ x: canvas.width, y: 100, width: 15, height: 15, collected: false });
            }
            
            // обработка препятствий
            for (let i = 0; i < obstacles.length; i++) {
                obstacles[i].x -= 5;
                ctx.drawImage(obstacleImg, obstacles[i].x, obstacles[i].y - (64 - obstacles[i].height), 64, 64);
                if (checkCollision(dino, obstacles[i])) {
                    gameRunning = false;
                    clearInterval(gameTimer);
                    alert(`Игра окончена! Ваш счёт: ${score}. Время: ${gameTime} сек`);
                    return;
                }
                if (obstacles[i].x < -64) {
                    obstacles.splice(i, 1);
                    i--;
                }
            }
            
            // обработка монеток
            for (let i = 0; i < coins.length; i++) {
                if (!coins[i].collected) {
                    coins[i].x -= 5;
                    ctx.fillStyle = '#ffd700';
                    ctx.beginPath();
                    ctx.arc(coins[i].x + coins[i].width/2, coins[i].y + coins[i].height/2, coins[i].width/2, 0, Math.PI*2);
                    ctx.fill();
                    if (checkCollision(dino, coins[i])) {
                        coins[i].collected = true;
                        score += 10;
                        scoreElement.textContent = score;
                    }
                }
                if (coins[i].x < -20) { coins.splice(i, 1); i--; }
            }
            
            requestAnimationFrame(gameLoop);
        }
        
        function checkCollision(a, b) {
            return a.x < b.x + b.width &&
                   a.x + a.width > b.x &&
                   a.y < b.y + b.height &&
                   a.y + a.height > b.y;
        }
        
        startBtn.addEventListener('click', startGame);
        document.addEventListener('keydown', e => { if (e.code === 'Space' && gameRunning) { jump(); e.preventDefault(); } });
        canvas.addEventListener('click', () => { if (gameRunning) jump(); });
    });
</script>
